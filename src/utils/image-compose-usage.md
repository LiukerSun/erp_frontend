# 图片合成功能使用说明

## 功能概述

图片合成功能允许您将商品主图与图框图片进行合成，并在图片上添加价格文字，生成美观的商品展示图片。支持坐标定位、透明背景、字体选择和配置管理。

## 主要特点

1. **主图覆盖整个画布**：商品主图会自动缩放并覆盖整个正方形画布
2. **图框叠加**：可选择上传图框图片进行叠加
3. **灵活的文字定位**：支持预设位置和自定义坐标定位
4. **实时位置预览**：可视化预览文字位置效果
5. **字体选择**：支持多种字体样式
6. **纯文字显示**：价格文字无背景、无装饰、无内边距，更加简洁
7. **配置管理**：支持保存、加载、管理多个配置方案
8. **批量处理**：支持批量合成多个产品的图片

## 使用步骤

### 1. 选择产品

在产品列表页面选择要合成图片的产品（至少选择一个有主图的产品）。

### 2. 配置合成选项

点击"图片合成配置"按钮，在弹出的配置窗口中设置：

#### 文字位置配置

- **文字位置**：选择预设位置或留空使用自定义坐标
  - 左上角 (top-left)
  - 右上角 (top-right)
  - 左下角 (bottom-left)
  - 右下角 (bottom-right)
  - 居中 (center)
- **自定义 X 坐标**：设置文字的水平位置（0-2000px）
- **自定义 Y 坐标**：设置文字的垂直位置（0-2000px）

#### 文字样式配置

- **文字字体**：选择字体样式（Arial、Helvetica、Times New Roman 等）
- **文字大小**：设置文字大小（8-72px）
- **文字颜色**：选择文字颜色

#### 图框配置（可选）

- **使用图框**：开启后可以上传图框图片
- **上传图框图片**：选择本地图框图片文件

#### 位置预览

- **实时预览**：可视化显示文字在图片中的位置
- **坐标显示**：实时显示当前文字的 X、Y 坐标

#### 配置管理

- **配置名称**：输入配置名称以保存当前设置
- **保存配置**：点击按钮保存当前配置
- **管理配置**：点击按钮打开配置管理窗口
- **快速加载配置**：从下拉列表中选择要加载的配置

### 3. 配置管理

在配置管理窗口中可以：

- **查看所有配置**：显示已保存的配置列表
- **加载配置**：点击"加载"按钮应用选中的配置
- **设为默认**：将选中的配置设为默认配置
- **删除配置**：删除不需要的配置

### 4. 开始合成导出

点击"导出合成图片"按钮，系统会：

1. 显示合成预览信息
2. 确认后开始批量合成
3. 生成 ZIP 压缩包并自动下载

## 合成效果

### 合成层次（从下到上）

1. **商品主图**（最底层）：缩放后覆盖整个正方形画布
2. **图框图片**（中间层）：叠加在商品主图上，居中显示
3. **价格文字**（最上层）：显示在指定位置或坐标

### 画布规格

- **形状**：正方形画布
- **尺寸**：可自定义（默认 800x800 像素）
- **比例**：1:1 正方形比例

### 文字样式

- 支持多种字体选择
- 支持自定义字体大小、颜色
- 纯文字显示，无背景、无装饰、无内边距
- 支持预设位置和精确坐标定位

## 位置预览功能

### 预览界面

- **正方形预览区域**：200x200 像素的正方形预览区域
- **网格背景**：便于观察位置关系
- **商品图片区域**：蓝色虚线框表示商品图片区域
- **文字预览**：实时显示价格文字的位置和样式
- **坐标指示器**：显示当前文字的精确坐标

### 预览特点

- **实时更新**：修改配置时预览立即更新
- **正方形比例**：预览区域与实际画布保持相同的正方形比例
- **坐标缩放**：预览区域 200x200，实际画布 800x800，坐标自动缩放 4 倍
- **样式同步**：字体、大小、颜色与最终效果一致
- **居中显示**：预览区域在配置窗口中居中显示

## 坐标定位说明

### 预设位置

- **左上角**：距离左上角 20px
- **右上角**：距离右上角 20px
- **左下角**：距离左下角 20px
- **右下角**：距离右下角 20px
- **居中**：画布中心位置

### 自定义坐标

- **X 坐标**：从左边缘到文字左边缘的距离
- **Y 坐标**：从上边缘到文字基线的距离
- **优先级**：自定义坐标优先于预设位置

## 配置管理功能

### 保存配置

1. 在配置窗口中设置所有参数
2. 输入配置名称（必填）
3. 点击"保存配置"按钮

### 加载配置

1. 在"快速加载配置"下拉列表中选择配置
2. 或点击"管理配置"按钮，在管理窗口中选择

### 默认配置

- 系统会自动加载默认配置
- 可以设置任意配置为默认配置
- 下次打开时会自动应用默认配置

## 技术特点

1. **Canvas API**：使用浏览器原生 Canvas API 进行图片处理
2. **异步处理**：支持大量图片的异步批量处理
3. **内存优化**：及时释放图片资源，避免内存泄漏
4. **错误处理**：完善的错误处理和用户提示
5. **本地存储**：配置保存在浏览器本地存储中
6. **实时预览**：基于 Canvas 的实时位置预览

## 注意事项

1. **主图要求**：确保产品有主图，否则无法进行合成
2. **图框格式**：支持常见的图片格式（JPG、PNG、WebP 等）
3. **浏览器兼容性**：需要支持 Canvas API 的现代浏览器
4. **文件大小**：大量图片合成可能需要较长时间，请耐心等待
5. **网络要求**：需要稳定的网络连接来加载图片
6. **坐标范围**：自定义坐标应在画布尺寸范围内
7. **配置存储**：配置保存在浏览器本地，清除浏览器数据会丢失配置
8. **字体支持**：某些字体可能在不同系统上显示效果不同

## 常见问题

### Q: 为什么合成后的图片主图覆盖了整个画布？

A: 这是设计特性，确保商品图片能够完整展示，不会被裁剪。

### Q: 如何精确控制文字的位置？

A: 可以使用自定义 X、Y 坐标来精确控制文字的位置，或使用位置预览功能实时调整。

### Q: 如何设置透明背景？

A: 系统默认使用纯文字显示，无背景、无装饰，无需额外设置。

### Q: 配置保存在哪里？

A: 配置保存在浏览器的本地存储中，不会上传到服务器。

### Q: 如何分享配置给其他人？

A: 目前配置只能保存在本地，暂不支持配置分享功能。

### Q: 预览效果与实际效果一致吗？

A: 预览效果与实际合成效果基本一致，但可能存在细微差异。

### Q: 合成速度很慢怎么办？

A: 大量图片合成需要时间，建议分批处理或减少同时处理的产品数量。
